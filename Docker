<h1>Docker</h1>

<p>2016-04-03 00:39:29 Sunday</p>

<p><a href="https://www.docker.com/" target="_blank">https://www.docker.com/</a>&nbsp;|&nbsp;<a href="http://www.docker.org.cn/" target="_blank">http://www.docker.org.cn/</a></p>

<blockquote>
<p>Build, Ship, Run</p>
</blockquote>

<p>An open platform for distributed applications for developers and sysadmins</p>

<h2>æ¦‚å¿µ</h2>

<p>docker åœ¨ Linux ä¸ŠåŸç”Ÿæ”¯æŒï¼Œæ‰€ä»¥æ— éœ€å€ŸåŠ©&nbsp;docker-machineã€‚åœ¨ Windows æˆ–è€… OSX ä¸Šåˆ™éœ€è¦ docker-machine åˆ›å»º Linux&nbsp;è™šæ‹Ÿæœºæ¥å¾—åˆ°æ”¯æŒã€‚</p>

<p>ç”¨ brew å®‰è£… docker å’Œ docker-machineã€‚docker-machine å‘½ä»¤æ˜¯ boot2docker å‘½ä»¤çš„æ›¿ä»£ï¼Œç”¨æ¥åˆ›å»ºå¹¶ç®¡ç† machineï¼Œä¾› docker å‘½ä»¤ä½¿ç”¨ã€‚</p>

<p>`docker pull &lt;repo&gt; å¾—åˆ°çš„æ˜¯ imageï¼Œ`docker rmi &lt;image id&gt;` å¯åˆ é™¤ imageï¼Œ`docker images` å¯åˆ—å‡ºæœ¬åœ°æ‰€æœ‰ image</p>

<p>`docker ps -a` åˆ—å‡ºçš„æ˜¯æ‰€æœ‰ containerï¼Œ`docker rm &lt;container id&gt;` å¯åˆ é™¤ containerã€‚</p>

<h2>VirtualBox ç½‘å¡é…ç½®</h2>

<p>2016-06-23 22:17 Thursday</p>

<p>åˆšåˆš fm start æŠ¥é”™ï¼šError checking TLS connection: Error checking and/or regenerating the certsï¼Œæƒ³æ¥æ˜¯å› ä¸ºæœ€è¿‘ä¸ºäº†è®©æ‰‹æœºèƒ½å¤Ÿè®¿é—® docker ä¸­çš„æœåŠ¡è€Œæ·»åŠ äº†ç¬¬ä¸‰å—ç½‘å¡ï¼Œä»¥åŠç›¸å…³çš„ä¸€äº›ä¹±æ“ä½œå¯¼è‡´ã€‚æŠ˜è…¾äº†ä¸€ä¼šé€šè¿‡ fm ls å‘ç° fm start ä¸€ç›´å¾—ä¸åˆ° IP æ˜¯å› ä¸ºæ‰§è¡Œäº†å‘½ä»¤ ip addr show dev eth1ï¼Œè€Œ eth1 å¯¹åº”çš„å°±æ˜¯ VirtualBox ä¸­çš„ç¬¬äºŒå—ç½‘å¡ã€‚å› æ­¤ eth0 å¯¹åº”çš„ç¬¬ä¸€å—ç½‘å¡å¿…é¡»æœ‰æ•ˆï¼Œè®°å¾—åŸæ¥æ˜¯&ldquo;ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰&rdquo;ã€‚ç„¶åç¬¬äºŒå—ç½‘å¡é€‰æ‹©&ldquo;ä»…ä¸»æœºï¼ˆHost-Onlyï¼‰é€‚é…å™¨&rdquo;åå°±å¤ªå¹³äº†ã€‚</p>

<p>2016-07-10 13:25 Sunday æ—©ä¸Š10000æ¥ç”µè¯´å¤–ç½‘ ip å‡†å¤‡å¥½äº†ã€‚ä»Šå¤©å¿…é¡»å¾—åœ¨å®¶æ‰“æ‰«å«ç”Ÿäº†</p>

<p>ç»•äº†åŠå¤©ï¼Œä¸€ç›´å›°æƒ‘äºä¸ºä»€ä¹ˆæœ¬æœºè¿ä¸Šäº† VPNï¼Œdocker-machine å´å¯¹å¤–æ˜¾ç¤ºè¿˜æ˜¯åŸæ¥çš„ IPï¼ŒåŸæ¥æ˜¯å› ä¸ºé‚£å—åœ¨ VirtualBox é‡Œæ‰‹åŠ¨æ·»åŠ çš„ç¬¬ä¸‰å—æ¡¥æ¥æ¨¡å¼çš„ç½‘å¡ï¼ï¼ç™½æŠ˜è…¾ OSX ä¸Šçš„ route å‘½ä»¤äº†ã€‚ä¸è¿‡æœ‰æœºä¼šå€’æ˜¯å¯ç»§ç»­ç ”ç©¶ netstat -nr åˆ—å‡ºçš„è·¯ç”±è¡¨ã€‚</p>

<p>æ—©ä¸ŠæŸ¥åˆ° docker æœ‰ä¸ªå·¥å…·å« pipeworkï¼Œå¯ä»¥æ–¹ä¾¿åœ°æŠŠæŸä¸ªçª—å£æ¡¥æ¥åˆ°ä¸»æœºæ‰€åœ¨ç½‘ç»œï¼Œè¿™ä¸ªå¤ªç¥äº†ï¼Œæœ‰æœºä¼šå†ç ”ç©¶ã€‚</p>

<h2>VirtualBox ç›®å½•æ˜ å°„</h2>

<p>2016-04-05 20:46 Tuesday</p>

<p>é»˜è®¤ /Users å·²ç»æ˜ å°„ï¼Œä½†å…¶ä»–ç›®å½•çš„æ˜ å°„éœ€è¦å¦‚ä¸‹æ­¥éª¤æ¥å®ç°</p>

<ol>
	<li>é€šè¿‡ VirtualBox çš„å›¾å½¢ç•Œé¢ &ldquo;è®¾ç½®&rdquo; -&gt; &ldquo;å…±äº«æ–‡ä»¶å¤¹&rdquo; æ‰‹åŠ¨æ·»åŠ å…±äº«æ–‡ä»¶å¤¹è·¯å¾„ /WORK</li>
	<li>è¿›å…¥è™šæ‹Ÿæœºå®ä¾‹ï¼Œæ‰§è¡Œå‘½ä»¤ `sudo VBoxControl sharedfolder list`&nbsp;ç¡®è®¤ /WORK ç›®å½•å·²ç»è¢«è¯†åˆ«</li>
	<li>æ‰‹åŠ¨åˆ›å»ºè¢«æ˜ å°„ç›®å½•ï¼š`sudo mkdir /WORK`</li>
	<li>æ‰‹åŠ¨æŒ‚è½½ï¼š`sudo mount -t vboxsf WORK /WORK`</li>
</ol>

<p>2016-07-05 15:40 Tuesday</p>

<p>æŠ˜è…¾äº†ä¸¤ä¸‰å¤©&nbsp;Wordpressï¼Œå‘ç° docker çš„æ€§èƒ½ç›¸å½“å·®ï¼ŒåŸå› åœ¨äº vboxsf è¿™ä¸ª VirtualBox çš„å…±äº«æ–‡ä»¶ç³»ç»Ÿã€‚ä»£ä¹‹ä»¥ NFSï¼Œæ€§èƒ½æœç„¶æœ‰äº†æ˜æ˜¾çš„æå‡ï¼ŒåŸºæœ¬ä¸Šæ— æ’ä»¶çš„ Wordpress é¦–é¡µä» 2 ç§’å¤šå˜æˆäº† 1 ç§’ä»¥ä¸‹</p>

<pre>
## -mask requires -net
## -mapall=mlhch çš„æ„æ€æ˜¯ï¼ŒæŠŠè¿œç¨‹æ‰€æœ‰ç”¨æˆ·éƒ½å½“ä½œæœ¬åœ°çš„ mlhch ç”¨æˆ·ï¼Œæ‹¥æœ‰ mlhch ç”¨æˆ·çš„æƒé™
/WORK 192.168.99.100 -alldirs -mapall=mlhch</pre>

<p>ç„¶ååœ¨ docker-machine ä¸­æŒ‚è½½</p>

<pre>
## http://nfs.sourceforge.net/nfs-howto/ar01s05.html
## rsize and wsize
sudo mount 192.168.99.1:/WORK /WORK -o rw,async,noatime,rsize=32768,wsize=32768,proto=tcp
</pre>

<h2>å®‰è£…</h2>

<p>https://www.docker.com/products/docker-toolbox</p>

<p>brew å®‰è£…çš„ç‰ˆæœ¬ä¸å®˜ç½‘ä¸‹è½½çš„ç‰ˆæœ¬ä¸€è‡´ã€‚</p>

<pre>
$ brew install docker
==&gt; Downloading https://homebrew.bintray.com/bottles/docker-1.10.3.el_capitan.bottle.tar.gz
######################################################################## 100.0%
==&gt; Pouring docker-1.10.3.el_capitan.bottle.tar.gz
==&gt; Caveats
Bash completion has been installed to:
  /usr/local/etc/bash_completion.d

zsh completion has been installed to:
  /usr/local/share/zsh/site-functions
==&gt; Summary
ğŸº  /usr/local/Cellar/docker/1.10.3: 10 files, 11.2M</pre>

<pre>
$ docker -v
Docker version 1.10.3, build 20f81dd
</pre>

<pre>
$ brew install docker-machine
==&gt; Downloading https://homebrew.bintray.com/bottles/docker-machine-0.6.0.el_capitan.bottle.tar.gz
Already downloaded: /Library/Caches/Homebrew/docker-machine-0.6.0.el_capitan.bottle.tar.gz
==&gt; Pouring docker-machine-0.6.0.el_capitan.bottle.tar.gz
==&gt; Caveats
Bash completion has been installed to:
&nbsp; /usr/local/etc/bash_completion.d
==&gt; Summary
ğŸº &nbsp;/usr/local/Cellar/docker-machine/0.6.0: 5 files, 36.8M
</pre>

<h2>ä½¿ç”¨</h2>

<h3>Use Machine to run Docker containers</h3>

<p>https://docs.docker.com/machine/get-started/</p>

<h4>Prerequisites</h4>

<ul>
	<li>
	<p>Make sure you have&nbsp;<a href="https://www.virtualbox.org/wiki/Downloads" target="_blank">the latest VirtualBox</a>&nbsp;correctly installed on your system. If you used&nbsp;<a href="https://www.docker.com/products/docker-toolbox" target="_blank">Toolbox</a>&nbsp;for&nbsp;<a href="https://docs.docker.com/engine/installation/mac/" target="_blank">Mac</a>&nbsp;or&nbsp;<a href="https://docs.docker.com/engine/installation/windows/" target="_blank">Windows</a>&nbsp;to install Docker Machine, VirtualBox is automatically installed.</p>
	</li>
	<li>
	<p>If you used the Quickstart Terminal to launch your first machine and set your terminal environment to point to it, a default machine was automatically created. If this is the case, you can still follow along with these steps, but create another machine and name it something other than &ldquo;default&rdquo; (e.g., staging or sandbox).</p>
	</li>
</ul>

<p>æŸ¥çœ‹æ˜¯ç°æœ‰ machines</p>

<pre>
$ docker-machine ls
NAME &nbsp; ACTIVE &nbsp; DRIVER &nbsp; STATE &nbsp; URL &nbsp; SWARM &nbsp; DOCKER &nbsp; ERRORS
</pre>

<p>åˆ›å»º machine</p>

<pre>
$ docker-machine create --driver virtualbox default
Creating CA: ~/.docker/machine/certs/ca.pem
Creating client certificate: ~/.docker/machine/certs/cert.pem
Running pre-create checks...
(default) Image cache directory does not exist, creating it at ~/.docker/machine/cache...
(default) No default Boot2Docker ISO found locally, downloading the latest release...
(default) Latest release for github.com/boot2docker/boot2docker is v1.10.3
(default) Downloading ~/.docker/machine/cache/boot2docker.iso from https://github.com/boot2docker/boot2docker/releases/download/v1.10.3/boot2docker.iso...</pre>

<p>æ­¤å¤„è§†ç½‘é€Ÿä¼šåœæ»è®¸ä¹…ï¼Œä¸å¦‚æ‰‹åŠ¨ä¸‹è½½åæ”¾åˆ°&nbsp;~/.docker/machine/cache/boot2docker.iso</p>

<pre>
$ docker-machine create --driver virtualbox default
Running pre-create checks...
Creating machine...
(default) Copying ~/.docker/machine/cache/boot2docker.iso to ~/.docker/machine/machines/default/boot2docker.iso...
(default) Creating VirtualBox VM...
(default) Creating SSH key...
(default) Starting the VM...
(default) Check network to re-create if needed...
(default) Found a new host-only adapter: &quot;vboxnet1&quot;
(default) Waiting for an IP...
Waiting for machine to be running, this may take a few minutes...
Detecting operating system of created instance...
Waiting for SSH to be available...
Detecting the provisioner...
Provisioning with boot2docker...
Copying certs to the local machine directory...
Copying certs to the remote machine...
Setting Docker configuration on the remote daemon...
Checking connection to Docker...
Docker is up and running!
To see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: docker-machine env default
</pre>

<p>å†æŸ¥çœ‹ machines å°±æœ‰äº†åˆšåˆ›å»ºçš„&nbsp;machine äº†</p>

<pre>
$ docker-machine ls
NAME &nbsp; &nbsp; &nbsp;ACTIVE &nbsp; DRIVER &nbsp; &nbsp; &nbsp; STATE &nbsp; &nbsp; URL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SWARM &nbsp; DOCKER &nbsp; &nbsp;ERRORS
default &nbsp; - &nbsp; &nbsp; &nbsp; &nbsp;virtualbox &nbsp; Running &nbsp; tcp://192.168.99.100:2376 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v1.10.3
</pre>

<p>æŸ¥çœ‹ default è¿™ä¸ª machine çš„ä¸€äº›ä¿¡æ¯</p>

<pre>
$ docker-machine env default
export DOCKER_TLS_VERIFY=&quot;1&quot;
export DOCKER_HOST=&quot;tcp://192.168.99.100:2376&quot;
export DOCKER_CERT_PATH=&quot;/Users/mlhch/.docker/machine/machines/default&quot;
export DOCKER_MACHINE_NAME=&quot;default&quot;
# Run this command to configure your shell:&nbsp;
# eval $(docker-machine env default)</pre>

<p>æŠŠä¸Šè¿°è¾“å‡ºå½“ä½œ bash è„šæœ¬æ‰§è¡Œåï¼Œå…¶ä¸­çš„ç¯å¢ƒå˜é‡å°±å¯ç”¨äº†</p>

<pre>
$ eval $(docker-machine env default)
</pre>

<p>ssh å°±è¿™æ ·ç™»å½•äº†ï¼Œä¸éœ€è¦ç”¨æˆ·åå’Œå¯†ç </p>

<pre>
$ docker-machine ssh
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ## &nbsp; &nbsp; &nbsp; &nbsp; .
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ## ## ## &nbsp; &nbsp; &nbsp; &nbsp;==
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;## ## ## ## ## &nbsp; &nbsp;===
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;\___/ ===
&nbsp; &nbsp; &nbsp; ~~~ {~~ ~~~~ ~~~ ~~~~ ~~~ ~ / &nbsp;===- ~~~
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\______ o &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; __/
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\ &nbsp; &nbsp;\ &nbsp; &nbsp; &nbsp; &nbsp; __/
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \____\_______/
&nbsp;_ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; _ &nbsp; ____ &nbsp; &nbsp; _ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;_
| |__ &nbsp; ___ &nbsp; ___ | |_|___ \ __| | ___ &nbsp; ___| | _____ _ __
| &#39;_ \ / _ \ / _ \| __| __) / _` |/ _ \ / __| |/ / _ \ &#39;__|
| |_) | (_) | (_) | |_ / __/ (_| | (_) | (__| &nbsp; &lt; &nbsp;__/ |
|_.__/ \___/ \___/ \__|_____\__,_|\___/ \___|_|\_\___|_|
Boot2Docker version 1.10.3, build master : 625117e - Thu Mar 10 22:09:02 UTC 2016
Docker version 1.10.3, build 20f81dd</pre>

<h2>php-zendserver</h2>

<p>2016-04-04 22:35 Monday è€å©†å¸¦ç€æœµæœµè·Ÿç€å²³çˆ¶å²³æ¯å›äº†</p>

<p>https://hub.docker.com/_/php-zendserver/</p>

<pre>
$ docker pull php-zendserver
</pre>

<p>æ­¤æ­¥æ‰§è¡Œååˆ™å¯çœ‹åˆ°å¤šäº†ä¸€ä¸ª image f719</p>

<pre>
$ docker images
REPOSITORY &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TAG &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IMAGE ID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CREATED &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SIZE
php-zendserver &nbsp; &nbsp; &nbsp;latest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;f7193503fb87 &nbsp; &nbsp; &nbsp; &nbsp;2 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 754.2 MB
nginx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; latest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;af4b3d7d5401 &nbsp; &nbsp; &nbsp; &nbsp;3 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 190.5 MB</pre>

<p>å¦‚ä¸‹å‘½ä»¤æ˜¯é˜»æ–­å¼çš„ï¼Œæ— æ³• Ctrl+C ç»“æŸï¼Œåªèƒ½é€šè¿‡ docker ps æŸ¥çœ‹åˆ°&nbsp;CONTAINER IDï¼Œç„¶å</p>

<pre>
$ docker run -p 88:80 -p 10088:10081 php-zendserver
Zend Server initialization result: success.
Zend Server is ready for use
Your application is available at http://172.17.0.2
To access Zend Server, navigate to http://172.17.0.2:10081
Your admin password is MzFhNzY1
</pre>

<p>æ­¤æ—¶çœŸæ­£èƒ½è®¿é—®çš„åœ°å€æ˜¯ http://`docker-machine ip`:88 å’Œ http://`docker-machine ip`:10088</p>

<p>å¯æƒœ&nbsp;YOUR ZEND SERVER LICENSE HAS EXPIRED.</p>

<h2>php</h2>

<p>2015-04-05 16:04 Tuesday ä»Šå¤©ç§Ÿæˆ¿çš„äº‹æƒ…ç®—æ˜¯æå®šäº†</p>

<p>è§‚å¯Ÿåˆ° fdd5d å·²ç»å­˜åœ¨ï¼Œå¯æ¨æƒ³æ˜¯&ldquo;åˆ†å±‚ç¼“å­˜&rdquo;åœ¨èµ·ä½œç”¨ï¼Œä¸åŒçš„ image æœ‰ç€å…±åŒçš„ç¥–å…ˆ</p>

<pre>
$ docker pull php
Using default tag: latest
latest: Pulling from library/php

fdd5d7827f33: Already exists&nbsp;
a3ed95caeb02: Pull complete&nbsp;
2f584a474c46: Pull complete&nbsp;
b185147d01c6: Pull complete&nbsp;
6663e6f16e95: Pull complete&nbsp;
fd91f8bf39df: Pull complete&nbsp;
6d7c00c29f57: Pull complete&nbsp;
Digest: sha256:a98c4203f8d463ddc018948931ce70df4dd2204c3394cc183a5cc1f38b799c81
Status: Downloaded newer image for php:latest</pre>

<pre>
$ docker images
REPOSITORY &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TAG &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IMAGE ID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CREATED &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SIZE
php &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; latest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8c8eb06f7c64 &nbsp; &nbsp; &nbsp; &nbsp;2 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 483.8 MB
php-zendserver &nbsp; &nbsp; &nbsp;latest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;f7193503fb87 &nbsp; &nbsp; &nbsp; &nbsp;2 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 754.2 MB
nginx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; latest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;af4b3d7d5401 &nbsp; &nbsp; &nbsp; &nbsp;3 weeks ago &nbsp; &nbsp; &nbsp; &nbsp; 190.5 MB
</pre>

<p>æµ‹è¯•ä¸€ï¼š--rm è¡¨ç¤ºæ‰§è¡Œå®Œåç«‹å³åˆ é™¤ containerï¼Œç¬¬ä¸€ä¸ª php æ˜¯ imageï¼Œç¬¬äºŒä¸ª php æ˜¯ container ä¸­çš„ php å¯æ‰§è¡Œå‘½ä»¤</p>

<pre>
$ docker run -it --rm php php --version
PHP 7.0.4 (cli) (built: Mar 19 2016 00:06:16) ( NTS )
Copyright (c) 1997-2016 The PHP Group
Zend Engine v3.0.0, Copyright (c) 1998-2016 Zend Technologies
</pre>

<p>æµ‹è¯•äºŒï¼š-v è¡¨ç¤ºç›®å½•æ˜ å°„ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ$PWD æŒ‡çš„å¹¶ä¸æ˜¯ OSX ä¸Šæœ¬æœºå½“å‰è·¯å¾„ï¼Œè€Œæ˜¯ docker-machine ä¸Šçš„å½“å‰è·¯å¾„ã€‚å½“ $PWD ä½äº VirtualBox é»˜è®¤æŒ‚è½½çš„å…±äº«ç›®å½• /Users ä¹‹å¤–æ—¶ï¼Œå°±éœ€è¦æ‰‹åŠ¨æŒ‚è½½ OSX ä¸Šçš„å½“å‰è·¯å¾„ï¼Œæ¯”å¦‚ /WORK åˆ° docker-machine ä¸Šçš„ /WORKï¼Œå¦‚æ­¤ OSX ä¸Šä½äº /WORK ä¹‹ä¸‹çš„ $PWD å°±å’Œ docker-machine ä¸Šçš„ $PWD å¯¹åº”èµ·æ¥äº†ã€‚-w è¡¨ç¤ºåˆ‡æ¢å·¥ä½œç›®å½•åˆ°æŒ‡å®šç›®å½•ã€‚</p>

<pre>
$ docker run --rm -v &quot;$PWD&quot;:/var/www/aaa -w /var/www/aaa php ls -al
</pre>

<h2>apache/httpd+php</h2>

<p>2016-04-10 16:16 Sunday</p>

<p>å®˜æ–¹ httpd æ˜ åƒé»˜è®¤æŠŠ apache2 å®‰è£…åœ¨ /usr/local/apache2ï¼Œapt-get install libapache2-mod-php5 å /etc/apache2 åˆæˆä¸ºä¸»é…ç½®ç›®å½•ï¼Œæœ‰ç‚¹ä¹±ã€‚ä¸å¦‚ç›´æ¥ç”¨ php:5.5-apache è§£å†³é—®é¢˜ã€‚</p>

<p>2016-04-12 02:34 Tuesday åˆšçœ‹å®Œã€Šç§»åŠ¨è¿·å®«ã€‹ï¼Œæ­£ä¸‹è½½ã€Šç§»åŠ¨è¿·å®«2ã€‹ï¼Œå¤–é¢å¼€å§‹ä¸‹å°é›¨</p>

<p>php-apache é»˜è®¤ enable äº† mysqlndï¼Œä½†å¹¶æ²¡æœ‰å¼€å¯ --with-mysql=mysqlnd é€‰é¡¹ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨ mysql_connect å‡½æ•°æ¥è¿æ¥æ•°æ®åº“ã€‚æ­£ç¡®çš„è§£å†³åŠæ³•æ˜¯ï¼š</p>

<pre>
â€‹$ cat containers/php55-apache-mysql/Dockerfile&nbsp;
FROM php:5.5-apache

RUN docker-php-ext-configure mysql --with-mysql=mysqlnd &amp;&amp; \
&nbsp; &nbsp; docker-php-ext-install mysql</pre>

<p>å…¶å®æ­¤é—®é¢˜4å¤©å‰åœ¨ smshosting é¡¹ç›®ä¸­å·²ç»è§£å†³äº†ï¼Œä»Šå¤©ç™½èŠ±äº†ä¸€å¤©åˆèµ°äº†ä¸€éè€è·¯</p>

<pre>
$ gi l Dockerfile
* 2334dfc - Ma Lian -- 2016-04-07 15:15 Feature: docker build -t sms . (4 days ago)
</pre>

<h2>mysql</h2>

<p>2016-04-07 08:47&nbsp;Thursday æ˜¨å¤©æ”¶æ‹¾å¥½äº†å·¥ä½œå®¤çš„å½©é’¢å±‹</p>

<p>https://hub.docker.com/_/mysql/</p>

<pre>
$ docker pull mysql:5.5
</pre>

<p>ä¸åŠ  -d æ—¶ï¼Œå‰å°è¿è¡Œï¼Œä½†ä¸å“åº”&nbsp;Ctrl+Cï¼Œæ‰€ä»¥è¿˜æ˜¯åŠ  -d æ–¹ä¾¿ï¼Œä½†å‰å°è¿è¡Œæ–¹ä¾¿è§‚å¯Ÿé”™è¯¯ä¿¡æ¯ã€‚--name ç»™å®ƒèµ·ä¸ªå¥½è®°çš„åå­—ï¼Œæ–¹ä¾¿éšåå¼•ç”¨ã€‚-p æŠŠ container çš„ 3306 æ˜ å°„åˆ° &nbsp;docker-machine çš„ 3306ï¼Œè¿™æ ·æ–¹ä¾¿å…¶å®ƒ container è¿æ¥ã€‚-v æŠŠ docker-machine ä¸Šæ˜ å°„å¥½çš„ /mysqldata&nbsp;æŒ‚è½½åˆ° container é»˜è®¤çš„ mysql çš„&nbsp;data_dirï¼ˆ/var/lib/mysqlï¼‰ã€‚/mysqldata ä¸€å®šéœ€è¦å¯å†™ï¼Œé€šè¿‡ mount æ—¶è®¾å®š uid=999 æ¥å®ç°ï¼Œ999 æ˜¯&nbsp;container ä¸­ mysql ç”¨æˆ·çš„ idï¼Œå¯ç™»å½• container æŸ¥çœ‹ /etc/passwd å¾—åˆ°ã€‚æ­¤å¤„å•ç‹¬ç»™ mysql æ˜ å°„å¹¶æŒ‚è½½æ˜¯å› ä¸º /WORK ç›®å½•ä¸ºäº†å¯å†™å·²ç»æŒ‚è½½ä¸º docker(uid=1000) ç”¨æˆ·ï¼Œ/WORK/databases/mysqldata å—æ­¤å½±å“ä¹Ÿå±äº&nbsp;docker ç”¨æˆ·ã€‚</p>

<pre>
$ docker run -d --name mysql55 -p 3306:3306 -e MYSQL_ROOT_PASSWORD=aaaa -v /mysqldata:/var/lib/mysql:rw mysql:5.5</pre>

<p>æµ‹è¯•æ–¹å¼ä¸€ï¼Œå…¶ä¸­ mysql55 æ˜¯ä¸Šå¥ä¸­ç»™ç”Ÿæˆçš„ container çš„å‘½å</p>

<pre>
$ docker exec -it mysql55 bash&nbsp;</pre>

<p>æµ‹è¯•æ–¹å¼äºŒï¼Œå…¶ä¸­&nbsp;mysql55 æ˜¯ä¹‹å‰ç”Ÿæˆçš„ container çš„åå­—ï¼Œ-h çš„åœ°å€æ˜¯ &nbsp;container çš„çœŸæ­£åœ°å€ï¼Œè€Œä¸æ˜¯ docker-machine çš„åœ°å€ï¼Œä½†å¦‚æœ -p æ˜ å°„è¿‡çš„è¯ï¼Œå°±å¯ä»¥ç”¨ docker-machine çš„åœ°å€äº†ã€‚</p>

<pre>
$ docker run -it --link mysql55:mysql --rm mysql:5.5 sh -c &#39;exec mysql -h&quot;172.17.0.3&quot; -P&quot;3306&quot; -uroot -p&quot;aaaa&quot;&#39;
</pre>

<h2>postgres</h2>

<p>2016-04-08 09:42 Friday</p>

<p>https://hub.docker.com/_/postgres/</p>

<p>æœ¬æœºç›®å‰ postgresql ç‰ˆæœ¬æ˜¯ 9.4.5ï¼Œæ•…ä¸‹è½½ postgres:9.4</p>

<pre>
$ docker pull postgres:9.4
</pre>

<p>æœ¬ image é»˜è®¤å·²ç»å¼€å¯äº† 5432 ç«¯å£ï¼Œæ‰€ä»¥ Dockerfile ä¸­å°±ä¸ç”¨é‡å¤äº†</p>

<pre>
$ cat Dockerfile&nbsp;
FROM postgres:9.4

RUN localedef -i zh_CN -c -f UTF-8 -A /usr/share/locale/locale.alias zh_CN.UTF-8

ENV LANG zh_CN.utf8
</pre>

<pre>
$ docker build -t pg .</pre>

<p>åŒ&nbsp;mysqlï¼Œæ­¤å¤„ /pgdata ä¹Ÿéœ€è¦äº‹å…ˆåœ¨ VirtualBox ä¸­é…ç½®å¥½ï¼Œåœ¨ container ä¸­ postgres ç”¨æˆ·çš„ id ä¹Ÿæ˜¯ 999</p>

<pre>
$ docker run --name tp-pg -p 5432:5432 -v /pgdata:/var/lib/postgresql/data postgres-postgis</pre>

<p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯é»˜è®¤ postgresql åªä¾¦å¬&nbsp;localhostï¼Œæ‰€ä»¥å¤–éƒ¨è¡¨ç°å°±æ˜¯ 5432 ç«¯å£æ— æ³•è¿æ¥ï¼Œæ­¤æ—¶éœ€è¦ç¼–è¾‘æ•°æ®åº“ç›®å½•ä¸­çš„ postgresql.conf æ–‡ä»¶ï¼Œä¿®æ”¹ listen_addresses ä¸º *</p>

<pre>
$ vi /WORK/databases/pgdata/postgresql.conf</pre>

<pre>
listen_addresses = &#39;*&#39; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# what IP address(es) to listen on;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # comma-separated list of addresses;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # defaults to &#39;localhost&#39;; use &#39;*&#39; for all
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # (change requires restart)
#port = 5432 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;# (change requires restart)
</pre>

<h2>postgis</h2>

<p>2016-04-09 18:16 Saturday</p>

<p>åœ¨ Dockerfile ä¸­ä½¿ç”¨å¦‚ä¸‹ä¸¤ä¸ªå‘½ä»¤æ¥å®‰è£…&nbsp;postgisã€‚apt-get update æ˜¯å¿…è¦çš„ï¼Œå¦åˆ™ apt-get æ‰¾ä¸åˆ° postgis ç›¸å…³çš„åŒ…ã€‚å½“å‰ postgis æœ€æ–°ç‰ˆæœ¬å·²ç»æ˜¯ 2.2ï¼Œä½† /WORK/databases/pgdata ä¸­ä½¿ç”¨çš„è¿˜æ˜¯ 2.1ï¼Œæ‰€ä»¥æ­¤å¤„éœ€è¦å®‰è£… postgresql-9.4-postgis-2.1ã€‚</p>

<pre>
â€‹RUN apt-get update

RUN apt-get install -y postgresql-9.4-postgis-2.1</pre>

<h2>geoserver</h2>

<p>2016-04-08 13:22 Friday</p>

<p>https://hub.docker.com/_/java/</p>

<p>ä¸‹è½½è¿™ä¸ªæ˜ åƒæ—¶éœ€åå¤å°è¯•ï¼ŒVPN å¦‚æœä¸è¡Œå†å°è¯•å»æ‰ VPNï¼Œç»“æœä¸‹è½½æˆäº†ã€‚</p>

<pre>
$ docker pull java:7-jre-alpine</pre>

<p>å½“å‰ Dockerfile å¾ˆç®€å•ï¼Œè§£å‹ç„¶åå¾…è¿è¡Œ</p>

<pre>
$ cat Dockerfile&nbsp;
FROM java:7-jre-alpine

ENV GEOSERVER_HOME /geoserver-2.8.3

ADD $GEOSERVER_HOME-bin.zip /geoserver.bin.zip

RUN unzip /geoserver.bin.zip &gt; /dev/null
</pre>

<p>geoserver çš„ DATA_DIR&nbsp;ä¸éœ€è¦&nbsp; mysql å’Œ postgres é‚£æ ·çš„ä¸“æœ‰ç”¨æˆ·ï¼Œæ‰€ä»¥ç›´æ¥ä» /WORK ä¸‹æ˜ å°„å³å¯</p>

<pre>
$ docker run --name tp-geos -p 8080:8080 -v /WORK/databases/geodata:/geoserver-2.8.3/data_dir geos /geoserver-2.8.3/bin/startup.sh
</pre>

<p>æœ€åéœ€è¦æ³¨æ„çš„å°±æ˜¯ geoserver å¯åŠ¨åï¼Œå¦‚æœæœ‰æ•°æ®å­˜å‚¨ç”¨åˆ° postgresql æ•°æ®åº“çš„è¯ï¼Œä¿®æ”¹ç›¸å…³ host æŒ‡å‘ &nbsp;docker-machine çš„åœ°å€å°±è¡Œäº†ã€‚</p>

<h2>What is Docker Machine?</h2>

<blockquote>
<p>boot2docker -&gt; Docker Machine</p>

<p>https://github.com/boot2docker/boot2docker-cli -&gt; https://docs.docker.com/machine/</p>
</blockquote>

<p>Docker Machine is a tool that lets you install Docker Engine on virtual hosts, and manage the hosts with&nbsp;<code>docker-machine</code>&nbsp;commands. You can use Machine to create Docker hosts on your local Mac or Windows box, on your company network, in your data center, or on cloud providers like AWS or Digital Ocean.</p>

<p>Docker Machine æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œç”¨æ¥åœ¨è™šæ‹Ÿæœºä¸Šå®‰è£…å¹¶ç®¡ç† Docker Engineã€‚</p>

<p>Using&nbsp;<code>docker-machine</code>&nbsp;commands, you can start, inspect, stop, and restart a managed host, upgrade the Docker client and daemon, and configure a Docker client to talk to your host.</p>

<p>ä½¿ç”¨ docker-machine å‘½ä»¤è¡Œï¼Œä½ å¯ä»¥å¯åŠ¨ï¼Œç›‘è§†ï¼Œåœæ­¢å’Œé‡å¯ä¸€ä¸ªè¢«ç®¡ç†çš„ä¸»æœºã€‚</p>

<p>Point the Machine CLI at a running, managed host, and you can run<code>docker</code>&nbsp;commands directly on that host. For example, run<code>docker-machine env default</code>&nbsp;to point to a host called&nbsp;<code>default</code>, follow on-screen instructions to complete&nbsp;<code>env</code>&nbsp;setup, and run&nbsp;<code>docker ps</code>,<code>docker run hello-world</code>, and so forth.</p>
